# Mr ECU - Apache Configuration with SEO URLs

# Enable URL Rewriting
RewriteEngine On
RewriteBase /

# Prevent directory browsing
Options -Indexes

# Hide sensitive files
<FilesMatch "\.(ini|log|conf|sql|md)$">
    Require all denied
</FilesMatch>

# Hide system directories
RedirectMatch 403 ^/(.git|config|logs|temp|vendor|node_modules)

# Basic security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Compression for better performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType image/jpg "access plus 30 days"
    ExpiresByType image/jpeg "access plus 30 days"
    ExpiresByType image/gif "access plus 30 days"
    ExpiresByType image/png "access plus 30 days"
    ExpiresByType image/webp "access plus 30 days"
    ExpiresByType text/css "access plus 30 days"
    ExpiresByType text/javascript "access plus 30 days"
    ExpiresByType application/javascript "access plus 30 days"
</IfModule>

# ====================================
# SEO FRIENDLY URL REDIRECTIONS
# ====================================

# Force www (optional - uncomment if needed)
# RewriteCond %{HTTP_HOST} !^www\. [NC]
# RewriteRule ^(.*)$ http://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Remove trailing slashes (except for directories)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{THE_REQUEST} /([^?\s]*)/[?\s] [NC]
RewriteRule ^(.*)/ $1 [R=301,L]

# ====================================
# PRODUCT SYSTEM URL ROUTES
# ====================================

# Product detail page: /urun/product-slug
RewriteRule ^urun/([a-zA-Z0-9\-]+)/?$ product-detail.php?slug=$1 [QSA,L]

# Product category page: /kategori/category-slug  
RewriteRule ^kategori/([a-zA-Z0-9\-]+)/?$ product-category.php?slug=$1 [QSA,L]

# Product brand page: /marka/brand-slug
RewriteRule ^marka/([a-zA-Z0-9\-]+)/?$ product-brand.php?slug=$1 [QSA,L]

# Products listing page: /urunler
RewriteRule ^urunler/?$ products.php [QSA,L]

# Products with category filter: /urunler/category-slug
RewriteRule ^urunler/([a-zA-Z0-9\-]+)/?$ products.php?category=$1 [QSA,L]

# ====================================
# TUNING SYSTEM URL ROUTES (Existing)
# ====================================

# Tuning search page: /chip-tuning-arama
RewriteRule ^chip-tuning-arama/?$ tuning-search.php [QSA,L]

# Tuning results page: /chip-tuning-sonuclari
RewriteRule ^chip-tuning-sonuclari/?$ tuning-results.php [QSA,L]

# Brand specific tuning: /chip-tuning/brand-slug
RewriteRule ^chip-tuning/([a-zA-Z0-9\-]+)/?$ tuning-results.php?brand=$1 [QSA,L]

# Model specific tuning: /chip-tuning/brand-slug/model-slug
RewriteRule ^chip-tuning/([a-zA-Z0-9\-]+)/([a-zA-Z0-9\-]+)/?$ tuning-results.php?brand=$1&model=$2 [QSA,L]

# ====================================
# PAGE ROUTES
# ====================================

# Services page: /hizmetlerimiz
RewriteRule ^hizmetlerimiz/?$ services.php [QSA,L]

# About page: /hakkimizda  
RewriteRule ^hakkimizda/?$ about.php [QSA,L]

# Contact page: /iletisim
RewriteRule ^iletisim/?$ contact.php [QSA,L]

# ====================================
# USER SYSTEM ROUTES
# ====================================

# User login: /giris
RewriteRule ^giris/?$ login.php [QSA,L]

# User register: /kayit
RewriteRule ^kayit/?$ register.php [QSA,L]

# User logout: /cikis
RewriteRule ^cikis/?$ logout.php [QSA,L]

# Password reset: /sifre-sifirla
RewriteRule ^sifre-sifirla/?$ reset-password.php [QSA,L]

# ====================================
# ADMIN PANEL PROTECTION
# ====================================

# Admin panel - ensure HTTPS (uncomment for production)
# RewriteCond %{HTTPS} off
# RewriteRule ^admin(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Block common attack patterns
RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} ^.*(\[|\]|\(|\)|<|>|Ãª|"|;|\?|\*|=$).* [NC,OR]
RewriteCond %{QUERY_STRING} ^.*("|'|<|>|\|{).* [NC]
RewriteRule .* - [F]

# ====================================
# ERROR PAGES
# ====================================

ErrorDocument 403 /403.php
ErrorDocument 404 /404.php
ErrorDocument 500 /500.php

# ====================================
# MAINTENANCE MODE (Uncomment when needed)
# ====================================

# RewriteCond %{REQUEST_URI} !^/maintenance\.php$
# RewriteCond %{REQUEST_URI} !^/admin/
# RewriteCond %{REMOTE_ADDR} !^123\.456\.789\.0$  # Your IP
# RewriteRule ^(.*)$ /maintenance.php [R=503,L]

# ====================================
# LEGACY REDIRECTS (Add as needed)
# ====================================

# Example legacy product URLs
# RewriteRule ^eski-urun/([0-9]+)/?$ /urun/$1 [R=301,L]
# RewriteRule ^products/([0-9]+)/?$ /urun/$1 [R=301,L]

# ====================================
# SITEMAP AND SEO FILES
# ====================================

# Sitemap routing
RewriteRule ^sitemap\.xml$ sitemap.php [L]
RewriteRule ^robots\.txt$ robots.php [L]

# ====================================
# API ROUTES (if needed)
# ====================================

# API v1 routes
RewriteRule ^api/v1/products/?$ api/v1/products.php [QSA,L]
RewriteRule ^api/v1/brands/?$ api/v1/brands.php [QSA,L]
RewriteRule ^api/v1/categories/?$ api/v1/categories.php [QSA,L]

# ====================================
# WORDPRESS STYLE PRETTY PERMALINKS
# ====================================

# If no file or directory exists, try as a page slug
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([a-zA-Z0-9\-]+)/?$ page.php?slug=$1 [QSA,L]

# Final fallback to index.php for remaining routes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]
